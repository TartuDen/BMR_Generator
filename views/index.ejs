<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <title>Bootstrap Layout</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Your custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <title>Bootstrap Layout</title>

</head>

<body>

    <!-- Header -->
    <%- include("partials/header.ejs") %>

        <!-- Main content -->
        <div class="wrapper">
            <!-- Sidebar -->
            <%- include("partials/sidebar.ejs") %>

                <!-- Table content -->
                <%- include("partials/main-table.ejs") %>
        </div>

        <!-- Footer -->
        <%- include("partials/footer.ejs") %>

            <!-- Bootstrap JS -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
                crossorigin="anonymous">
                </script>
            
            <!-- Script for storing the received JWT token in local storage -->
            <script>
                // Retrieve the token passed from the server
                const token = '<%= token %>';

                // Store the token in local storage
                localStorage.setItem("jwtToken",token)
            </script>
            <script>
                var dataFromOperation = {};
                /**
                 * Save the selected item from a select element into the dataFromOperation object.
                 * 
                 * @param {HTMLSelectElement} selectElement - The select element from which to retrieve the selected value.
                 */
                function saveSelectedItem(selectElement) {
                    // Retrieve the selected value from the select element
                    var id = selectElement.id;
                    var value = selectElement.value;


                    // Add new elements into dataFromOperation
                    dataFromOperation[id] = value;
                    console.log(dataFromOperation);
                }
            </script>

            <!-- <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script> -->
            <script src="callFunc.js"></script>
            <script src="apiMocks.js"></script>
            <script src="api.js"></script>
            <script src="helpers.js"></script>
            <script src="operationClasses.js"></script>

            <script>

                /**
                 * Function to populate the equipment types dropdown.
                 * Retrieves the list of equipment types and populates the dropdown with them.
                 * 
                 * @returns {Promise<void>} A Promise that resolves when the dropdown is populated successfully.
                 */
                async function populateEquipmentTypes() {
                    try {
                        // Call GetListEquipmentTypesMOCK to retrieve the list of equipment types
                        const equipmentTypes = await GetListEquipmentTypesMOCK();

                        var selectElement = document.getElementById('equipmentType');

                        // Clear previous options
                        selectElement.innerHTML = '';

                        // Add default option "--select--"
                        addDefaultOption(selectElement);

                        // Add equipment types as options
                        equipmentTypes.forEach(function (equipmentType) {
                            var option = document.createElement('option');
                            option.value = equipmentType.name;
                            option.textContent = equipmentType.name;
                            selectElement.appendChild(option);
                        });
                    } catch (error) {
                        console.error("Error populating equipment types:", error);
                        // Handle the error if needed
                    }
                }

                // Call populateEquipmentTypes function when the page loads
                window.onload = function () {
                    populateEquipmentTypes();
                };


                // Function to fetch and populate the activityType dropdown with loading_of_solid activities based on equipmentType
                async function populateActivityType(equipmentType) {
                    try {
                        // Call GetListEquipmentTypesMOCK to retrieve the list of equipment types
                        const activityTypes = await GetListReactorActivityMOCK(dataFromOperation["equipmentType"]);
                        var selectElement = document.getElementById('activityType');

                        // Clear previous options
                        selectElement.innerHTML = '';

                        // Add default option "--select--"
                        addDefaultOption(selectElement);

                        // Add equipment types as options
                        activityTypes.forEach(function (activity) {
                            var option = document.createElement('option');
                            option.value = activity.Content;
                            option.textContent = activity.OperationType;
                            selectElement.appendChild(option);
                        });

                        // Event listener for when an option is selected
                        selectElement.addEventListener('change', function () {
                            // Get the selected option
                            var selectedOption = selectElement.options[selectElement.selectedIndex];

                            let selectedActivityType = selectedOption.textContent;
                            let operationType = "operationType";

                            // Add operationType the dataFromOperation object
                            dataFromOperation[operationType] = selectedActivityType;
                        });

                    } catch (error) {
                        console.error("Error populating activity types:", error);
                        // Handle the error if needed
                    }
                }

                /**
                 * Populates the description of an activity within a specified div element.
                 * @param {string} activityType - The type of activity to populate the description for.
                 */
                async function populateDescription() {
                    let divElement = document.getElementById('description');

                    // Clear previous content
                    divElement.innerHTML = '';

                    if (dataFromOperation["activityType"]) {
                        // Call replaceTextWithSelect to populate the description
                        await replaceTextWithSelect(dataFromOperation["activityType"]).then((description) => {
                            // Create a new <p> element
                            let newP = document.createElement("p");

                            // Set the html content of the <p> element with the populated description
                            newP.innerHTML = description;

                            // Append the <p> element to the div
                            divElement.appendChild(newP);
                        }).catch((error) => {
                            console.error('Error populating description:', error);
                        });
                    } else {
                        console.error('Activity type is not defined');
                        // If the activity type is not defined, handle it accordingly
                    }
                }


                /**
                 * Adds a default "--select--" option to a dropdown select element.
                 * 
                 * @param {HTMLElement} selectElement - The dropdown select element to which the default option will be added.
                 */
                function addDefaultOption(selectElement) {
                    // Create the default option element
                    var defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = '--select--';

                    // Append the default option to the select element
                    selectElement.appendChild(defaultOption);
                }

                // Function to parse dataFromOperation to Operation class
                function parseDataToOperation() {
                    // Create an list of instances of Equipment class
                    let equipmentList = [];
                    for (let key in dataFromOperation) {
                        if (key.startsWith('equipment_')) {
                            let equipmentName = key.replace('equipment_', '');
                            let equipment = new Equipment(equipmentName, dataFromOperation[key]);
                            equipmentList.push(equipment);
                        }
                    }
                    
                    // Create an instance of TypicalActivity class
                    let Activity = new TypicalActivity(
                        dataFromOperation['operationType'],
                        dataFromOperation['activityType'],
                        null,
                        null,
                        null,
                        null,
                        equipmentList
                    );

                    // Create an instance of Operation class
                    let operation = new Operation(1, dataFromOperation['equipmentType'], Activity);

                    // Do something with the operation object, such as sending it to the server or displaying it on the page
                    console.log(operation);
                }

                // Function to purge dataFromOperation object
                function purgeDataFromOperation() {
                    // Clear the dataFromOperation object EXCEPT equipmentType
                    for (let key in dataFromOperation) {
                        if (key !== 'equipmentType') {
                            delete dataFromOperation[key];
                        }
                    }
                    console.log("Data from operation purged.");
                }


            </script>



</body>

</html>